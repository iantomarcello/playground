<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Playground</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Oswald:wght@200&family=Sora:wght@100..800&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      * {
        font-family: "Sora", sans-serif;
      }

      .wrapper {
        --columns: 5;
        --rows: 5;
        --cell_size: 56px;
        display: grid;
        margin: auto;

        width: 100%;
        height: 100dvh;
        place-items: center;
      }

      .cells-wrapper {
        display: grid;
        grid-template-columns: repeat(var(--columns), var(--cell_size));
        grid-template-rows: repeat(var(--rows), var(--cell_size));
        gap: inherit;
      }

    </style>
  </head>
  <body class="bg-purple-400">
    <main class="max-w-3xl w-100 mx-auto">
      <section id="$wrapper" class="wrapper gap-4">
        <div id="$cellsWrapper" class="cells-wrapper">
          <!-- Populate by JS -->
        </div>
      </section>
    </main>
    <script type="module" src="./le-swatch.js"></script>
    <script>
      function getRowAndColumn() {
        const rows = getComputedStyle($wrapper).getPropertyValue('--rows');
        const columns = getComputedStyle($wrapper).getPropertyValue('--columns');
        return [rows, columns];
      }

      function populateCells(rows, columns) {
        for (let i = 1; i <= columns; i++) {
          for (let j = 1; j <= rows; j++) {
            let swatch = document.createElement('le-swatch')
            swatch.addEventListener('change', handleSwatchChange);
            swatch.dataset.x = i;
            swatch.dataset.y = j;
            $cellsWrapper.appendChild(swatch);
          }
        }
      }

      function handleSwatchChange(event) {
        let {x, y} = event.currentTarget.dataset;
        document.querySelectorAll('le-swatch').forEach((swatch) => {
          if (swatch !== event.currentTarget) {
            // TODO: Math the logic to spread colour evenly, look for Vector distance calculation
            swatch.colour = event.detail.colour;
          }
        })
      }

      function init() {
        let [rows, columns] = getRowAndColumn();
        populateCells(rows, columns)
      }
      init();


    </script>
  </body>
</html>
